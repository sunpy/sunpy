language: python

python:
  - 2.7

virtualenv:
     system_site_packages: false

#There are a few environments configured, we specify a minumum version of mpl
#and a exact version of Numpy to test against.
env:
    - NUMPY_VERSION=1.7.1 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.12.0 SUDS_PKG='suds'
    global:
        - PIP_WHEEL_COMMAND="--find-links http://sunpy.cadair.com/wheelhouse/index.html --use-wheel"
matrix:
    include:
      - python: 2.6
        env: NUMPY_VERSION=1.7.1 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.12.0 SUDS_PKG='suds'
      - python: 2.7
        env: NUMPY_VERSION=1.6.2 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.12.0 SUDS_PKG='suds'
      - python: 2.6
        env: NUMPY_VERSION=1.6.2 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.12.0 SUDS_PKG='suds'
      - python: 2.7
        env: NUMPY_VERSION=1.7.1 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.11.0 SUDS_PKG='suds'
      - python: 2.6
        env: NUMPY_VERSION=1.7.1 MATPLOTLIB_VERSION=1.3.0 PANDAS_VERSION=0.11.0 SUDS_PKG='suds'

before_install:
   # We do this to make sure we get the dependencies so pip works below
   - sudo apt-get update -qq
   - sudo apt-get install -qq cython libatlas-dev liblapack-dev gfortran
   - pip install pip --upgrade
   - pip install setuptools>=0.8 --upgrade
   - wget http://openjpeg.googlecode.com/files/openjpeg-1.5.0-Linux-x86_64.tar.gz
   - sudo tar -xvf openjpeg-1.5.0-Linux-x86_64.tar.gz --strip-components=1 -C /

# Install from wheels
install:
#Install Numpy first so we force the version we are using
   - pip install $PIP_WHEEL_COMMAND numpy==$NUMPY_VERSION
# Install the other requirements to the desired version
   - pip install $PIP_WHEEL_COMMAND matplotlib==$MATPLOTLIB_VERSION
   - pip install $PIP_WHEEL_COMMAND scipy
# Manually install pandas deps due to a pip 1.4 / pytz bug
   - pip install  $PIP_WHEEL_COMMAND pytz==2013b
   - pip install  $PIP_WHEEL_COMMAND python-dateutil
   - pip install  $PIP_WHEEL_COMMAND pandas==$PANDAS_VERSION
   - pip install  $PIP_WHEEL_COMMAND astropy
   - pip install  $PIP_WHEEL_COMMAND pytest $SUDS_PKG beautifulsoup4

# command to run tests
script:
  - python setup.py develop
  - py.test
